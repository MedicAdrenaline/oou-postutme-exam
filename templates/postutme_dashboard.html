<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>POSTUTME Subject Selection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        /* Light/Dark Theme Transitions */
body {
  transition: background-color 0.3s, color 0.3s;
}

/* Dark Mode Body */
.dark-mode {
  background-color: #121212 !important;
  color: #e0e0e0 !important;
}

/* Example for sections/containers */
.dark-mode .your-container-class {
  background-color: #1e1e1e !important;
  color: #e0e0e0 !important;
}

/* Button Styles */
.toggle-container button {
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  background-color: #007bff;
  color: white;
  cursor: pointer;
}
.toggle-container button:hover {
  background-color: #0056b3;
}
        body { background-color: rgb(255, 255, 255); }
        .container { margin-top: 40px; max-width: 800px;}
        .quote { font-style: italic; margin-bottom: 20px; text-align: center; color: black; font-size: larger; font-weight: bolder; }
        .subjects-list label { font-size: 1.2em; }
        .subjects-list input[type="checkbox"] { transform: scale(1.4); margin-right: 10px; }
        .english-locked { font-weight: bold; color: #f700ff; }
        .start-btn { width: 50%; right: 50px }
        .action-buttons {
            display: flex;
            justify-content: flex-start;
            gap: 10px;
            margin-top: 20px;
        }
        .exam-actions {
            position: fixed;
            bottom: 20px;
            right: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h4 class="text-center mb-4" style="color: black; font-size: x-large; font-weight: bolder;">
        SELECT SUBJECT(max:4). 
    It's a good practice to always select at least 3 subjects(Utme combination) + English, then GK(optional) as it's a 30mins Exam. This trains you to be time-conscious</h4>
    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mt-3">
          {% for category, message in messages %}
            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}


    <form id="subjectForm" action="{{ url_for('postutme_dashboard') }}" method="POST">
  <div class="subjects-list mb-3">
    <label><input type="checkbox" name="subjects" value="English" checked disabled /> English</label><br />
    <label><input type="checkbox" name="subjects" value="Mathematics" /> Mathematics</label><br />
    <label><input type="checkbox" name="subjects" value="Chemistry" /> Chemistry</label><br />
    <label><input type="checkbox" name="subjects" value="Physics" /> Physics</label><br />
    <label><input type="checkbox" name="subjects" value="Biology" /> Biology</label><br />
    <label><input type="checkbox" name="subjects" value="Agriculture" /> Agriculture</label><br />
    <label><input type="checkbox" name="subjects" value="Government" /> Government</label><br />
    <label><input type="checkbox" name="subjects" value="General Knowledge" /> General Knowledge</label><br />
  </div>

  <!-- Hidden input to ensure English gets submitted -->
  <input type="hidden" name="subjects" value="English" />

  <button type="submit" class="btn btn-primary start-btn" id="start-new-exam-btn">üÜï Start New Exam</button>
</form>

    <div class="mt-3 container">
    {% if result %}
        <h5>Retake Last Exam</h5>
        <form action="{{ url_for('retake_postutme_exam') }}" method="POST">
            <button type="submit" class="btn btn-success w-60" id="retake-exam-btn">üîÅ Retake Last Exam</button>
        </form>
        <a href="{{ url_for('postutme_result', result_id=result.id) }}" class="btn btn-info w-60 mt-3">üìä View Last Result</a>
    {% else %}
        <div class="alert alert-info text-center" role="alert">
            No previous POSTUTME attempts found.
        </div>
    {% endif %}
</div>

<div class="mt-3 container" style="background-size: 0%;">
    <a href="/dashboard" class="btn btn-secondary w-100">Back to Dashboard</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Validate subject selection before submitting
    const form = document.getElementById('subjectForm');
    form.addEventListener('submit', function(event) {
        const checkedSubjects = form.querySelectorAll('input[name="subjects"]:checked');
        if (checkedSubjects.length > 5) {
            alert('You can only select up to 5 subjects at a time');
            event.preventDefault();
        }
    });

    // Clear timer on Start New Exam
    document.getElementById('start-new-exam-btn').addEventListener('click', () => {
        localStorage.removeItem('postutmeTimeLeft');
        localStorage.removeItem('postutmeCurrentQuestionIndex');
        localStorage.removeItem('postutmeStarted');
        localStorage.removeItem('postutmeCurrentSubject');
        localStorage.removeItem('postutmeLastQuestionIndexPerSubject');
        localStorage.setItem('postutmeStarted', 'true');
    });

    // Clear timer on Retake Last Exam
    document.getElementById('retake-exam-btn').addEventListener('click', () => {
        localStorage.removeItem('postutmeTimeLeft');
        localStorage.removeItem('postutmeAnswers');
        localStorage.removeItem('postutmeCurrentQuestionIndex');
        localStorage.removeItem('postutmeCurrentSubject');
        localStorage.removeItem('postutmeLastQuestionIndexPerSubject');
        localStorage.setItem('postutmeStarted', 'true');
        

    });
    // Clear localStorage when starting a new exam
    document.getElementById('subjectForm').addEventListener('submit', function () {
        localStorage.removeItem('postutmeAnswers');
        localStorage.removeItem('jambTimeLeft');
        localStorage.removeItem('postutmeCurrentQuestionIndex');
        localStorage.removeItem('postutmeStarted');
    });

    // Validate retake form but do NOT change action URL
    document.getElementById('retakeForm')?.addEventListener('submit', function (event) {
        const selectedSubject = document.getElementById('subjectSelect').value;
        if (!selectedSubject) {
            event.preventDefault();
            alert("Please select a subject to retake.");
            return;
        }
        localStorage.removeItem('postutmeAnswers');
        localStorage.removeItem('postutmeTimeLeft');
        localStorage.removeItem('postutmeCurrentQuestionIndex');
        localStorage.removeItem('postutmeStarted');
    });

    // üîê Prevent forward navigation
    history.pushState({ page: 'dashboard' }, '', window.location.href);
    window.addEventListener('popstate', function (event) {
        if (event.state && event.state.page === 'forward') {
            const confirmLeave = confirm("Start new exam below?");
            if (!confirmLeave) {
                history.back();
            }
        } else {
            history.pushState({ page: 'forward' }, '', window.location.href);
        }
    });
  function toggleMode() {
  const isDark = document.body.classList.toggle("dark-mode");
  localStorage.setItem("theme", isDark ? "dark" : "light");
}
window.onload = () => {
  const savedTheme = localStorage.getItem("theme");
  if (savedTheme === "dark") {
    document.body.classList.add("dark-mode");
  }
}; 
</script>
<div class="toggle-container text-end p-3">
  <button onclick="toggleMode()">üåô Toggle Dark Mode</button>
</div>
<footer>
        <p class="footer-text" style="font-size: larger; font-weight: bolder; text-align: center;">Developed by Medic Adrenaline</p>
    </footer>
</body>
</html>